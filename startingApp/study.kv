<RootWidget@FloatLayout>:
    bg_source: "assets/StandardBackground.png"

    canvas.before:
        Rectangle:
            source: root.bg_source
            pos: self.pos
            size: self.size
            
    MDScreenManager:
        id: screen_manager_root
        ToDoScreen:
            name: "todo"
        FlashCardsScreen:
            name: "flashCards"
        TimerScreen:
            name: "timer"
        SettingsScreen:
            name: "settings"
        AIWordScreen:
            name: "ai"
        
    # Bottom Navigation Bar
    MDBoxLayout:
        id: bottom_nav
        size_hint_y: None
        height: dp(60)
        pos_hint: {"x": 0, "y": 0}
        spacing: dp(5)
        padding: dp(10)
        md_bg_color: 0.95, 0.95, 0.95, 1

        MDButton:
            style: "elevated"
            on_release: app.root.ids.screen_manager_root.current = "todo"
            MDButtonText:
                text: "To-Do"

        MDButton:
            style: "elevated"
            on_release: app.root.ids.screen_manager_root.current = "flashCards"
            MDButtonText:
                text: "Flash Cards"

        MDButton:
            style: "elevated"
            on_release: app.root.ids.screen_manager_root.current = "timer"
            MDButtonText:
                text: "Timer"

        MDButton:
            style: "elevated"
            on_release: app.root.ids.screen_manager_root.current = "ai"
            MDButtonText:
                text: "Definitions"

        MDButton:
            style: "elevated"
            on_release: app.root.ids.screen_manager_root.current = "settings"
            MDButtonText:
                text: "Settings"

<ToDoScreen>:
    MDBoxLayout:
        orientation: 'vertical'
        spacing: dp(10)
        padding: dp(10), dp(10), dp(10), dp(70) #left, top, right, bottom            
        
        ScrollView:
            MDBoxLayout:
                id: todo_items_container
                orientation: "vertical"
                size_hint_y: None
                height: self.minimum_height
                padding: dp(10)
                spacing: dp(10)

        
        # Expandable input box
        MDBoxLayout:
            id: input_box
            orientation: 'vertical'
            size_hint_y: None
            height: dp(60)
            spacing: dp(5)
            padding: dp(5)
            

            # Additional fields (hidden initially, opacity=0)
            MDTextField: #This one temporarily holds the header text
                fill_color: 0, 0, 0, 0  # Required transparency fix for dev version
                id: task_header_input
                mode: "outlined"

                MDTextFieldHintText:
                    text: "Input Task Header"

            MDTextField: #This one temporarily holds the description text
                fill_color: 0, 0, 0, 0  # Required transparency fix for dev version
                id: task_description_input
                mode: "outlined"

                MDTextFieldHintText:
                    text: "Input Task Description"

            MDTextField: #This one temporarily holds the due date
                fill_color: 0, 0, 0, 0  # Required transparency fix for dev version
                id: task_date_input
                mode: "outlined"

                MDTextFieldHintText:
                    text: "Input Task Due Date (DD/MM/YYYY)"
            

            # Initial single-line input (at bottom, always visible initially)
            MDButton:
                id: new_task_input
                style: "elevated"
                #fill_color: 0, 0, 0, 0  # Required transparency fix for dev version
                size_hint_y: None
                height: dp(40)
                on_release: root.expand_input()

                MDButtonText:
                    text: "Add a new task..."
        
        # Controls "Add Task" button
        MDButton:
            style: "elevated"
            size_hint_y: None
            height: dp(40)
            on_release: root.addTask()
            MDButtonText:
                text: "Add Task"
                #on_press: todolist.addTask()
       
<FlashCardsScreen>:
    name: "flashCards"

    MDBoxLayout:
        orientation: "vertical"
        padding: 0, 0, 0, dp(60)

        # --- Top buttons: View All (left) and Add (right) ---
        MDBoxLayout:
            size_hint_y: None
            height: dp(64)
            padding: dp(8)
            spacing: dp(8)

            # View All Cards button (LEFT)
            MDButton:
                id: view_toggle_btn
                size_hint: None, None
                size: dp(150), dp(40)
                style: "elevated"
                on_release: root.toggle_view_mode()
                MDButtonText:
                    text: "View All Cards"

            Widget:  # Spacer

            # Add Card button (RIGHT)
            MDButton:
                size_hint: None, None
                size: dp(130), dp(40)
                style: "elevated"
                on_release: root.open_add_dialog()
                MDButtonText:
                    text: "+ Add Card"

        # --- Container for both views (they swap visibility) ---
        FloatLayout:
            # --- SINGLE CARD VIEW - CENTERED ---
            FloatLayout:
                id: single_card_container
                padding: dp(60), dp(20), dp(60), dp(60)

                # Center the card
                AnchorLayout:
                    anchor_x: "center"
                    anchor_y: "center"

                    MDBoxLayout:
                        orientation: "vertical"
                        size_hint: None, None
                        width: min(root.width * 0.75, dp(625))
                        height: (self.width / 1.6667) + dp(32)

                        MDCard:
                            id: flashcard
                            elevation: 1
                            radius: 5
                            padding: "12dp"
                            ripple_behavior: True
                            on_release: root.flip_card()

                            size_hint: None, None
                            width: self.parent.width
                            height: self.width / 1.6667

                            MDLabel:
                                id: flashcard_text
                                text: root.current_text
                                halign: "center"
                                valign: "center"
                                theme_text_color: "Primary"
                                text_size: self.width * 0.9, None

                        MDLabel:
                            id: index_label
                            text: f"{root.current_index + 1}/{len(root.cards)}" if root.cards else ""
                            halign: "center"
                            theme_text_color: "Secondary"
                            size_hint_y: None
                            height: dp(32)

            # --- GRID VIEW - STARTS AT TOP OF THIS CONTAINER ---
            MDBoxLayout:
                id: grid_view_container
                orientation: "vertical"
                opacity: 0
                disabled: True
                size_hint_y: None
                height: 0

                MDLabel:
                    text: "All Flashcards"
                    halign: "center"
                    size_hint_y: None
                    height: dp(40)
                    font_size: "20sp"
                    bold: True

                ScrollView:
                    id: grid_scroll_view
                    do_scroll_x: False
                    do_scroll_y: True
                    bar_width: dp(10)

            # Left arrow - on top layer (moved AFTER other content)
            AnchorLayout:
                id: single_card_container_left_arrow
                anchor_x: "left"
                anchor_y: "center"
                size_hint_x: None
                width: dp(60)
                opacity: 1
                disabled: False

                MDIconButton:
                    icon: "chevron-left"
                    size_hint: None, None
                    user_font_size: "48dp"
                    size: dp(48), dp(48)
                    on_release: root.prev_card()

            # Right arrow - on top layer (moved AFTER other content)
            AnchorLayout:
                id: single_card_container_right_arrow
                anchor_x: "right"
                anchor_y: "center"
                size_hint_x: None
                width: dp(60)
                pos_hint: {"right": 1}
                opacity: 1
                disabled: False

                MDIconButton:
                    icon: "chevron-right"
                    size_hint: None, None
                    user_font_size: "48dp"
                    size: dp(48), dp(48)
                    on_release: root.next_card()

<TimerScreen@MDScreen>:
    MDBoxLayout:
        orientation: 'vertical'
        spacing: dp(10)
        padding: dp(10), dp(10), dp(10), dp(70)

        # Timer display
        MDLabel: 
            id: timer_display
            text: root.timer_text
            halign: "center"

        MDLabel:
            id: status_label
            text: "Press Start to begin."
            halign: "center"

        MDBoxLayout:
            id: buttons
            orientation: "horizontal"
            spacing: dp(20)
            size_hint_y: None
            size_hint_x: None
            width: self.minimum_width
            height: dp(50)
            halign: "center"
            pos_hint: {"center_x": 0.5}

            # Start button
            MDButton: 
                style: "elevated"
                on_release: root.start_pomodoro()
                MDButtonText:
                    text: "Start"

            # Stop button
            MDButton: 
                style: "elevated"
                on_release: root.stop_pomodoro()
                MDButtonText:
                    text: "Stop"

            # Reset button
            MDButton: 
                style: "elevated"
                on_release: root.reset_pomodoro()
                MDButtonText:
                    text: "Reset"

        # Inputs
        MDBoxLayout: 
            id: timer_input
            orientation: 'horizontal'
            size_hint_y: None
            height: dp(60)
            spacing: dp(5)
            padding: dp(5)  
        
            MDTextField:
                id: work_minutes_input
                fill_color: 0, 0, 0, 1
                mode: "filled"
                text: "25"
                on_text: root.validate_int(self, 1, 60)

                MDTextFieldHintText:
                    text: "Work Minutes"

            MDTextField:
                id: short_break_minutes_input
                fill_color: 0, 0, 0, 1
                mode: "filled"
                text: "5"
                on_text: root.validate_int(self, 1, 30)

                MDTextFieldHintText:
                    text: "Short Break Minutes"

            MDTextField:
                id: long_break_minutes_input
                fill_color: 0, 0, 0, 1
                mode: "filled"
                text: "15"
                on_text: root.validate_int(self, 1, 60)

                MDTextFieldHintText:
                    text: "Long Break Minutes"

            MDTextField:    
                id: sessions_input
                fill_color: 0, 0, 0, 1
                mode: "filled"
                text: "4"
                on_text: root.validate_int(self, 1, 24)

                MDTextFieldHintText:
                    text: "Amount of Sessions"
        
                
<SettingsScreen@MDScreen>:
    AnchorLayout:
        anchor_x: "center"
        anchor_y: "center"

        MDButton:
            style: "elevated"
            size_hint: (None, None)
            width: dp(200)
            height: dp(50)
            on_release: root.toggle_dark_mode()

            MDButtonText:
                text: "Dark Mode"