<RootWidget@FloatLayout>:
    bg_source: "assets/StandardBackground.png"

    canvas.before:
        Rectangle:
            source: root.bg_source
            pos: self.pos
            size: self.size
            
    MDScreenManager:
        id: screen_manager_root
        ToDoScreen:
            name: "todo"
        FlashCardsScreen:
            name: "flashCards"
        TimerScreen:
            name: "timer"
        SettingsScreen:
            name: "settings"
        
    # Bottom Navigation Bar
    MDBoxLayout:
        id: bottom_nav
        size_hint_y: None
        height: dp(60)
        pos_hint: {"x": 0, "y": 0}
        spacing: dp(5)
        padding: dp(10)
        md_bg_color: 0.95, 0.95, 0.95, 1

        MDButton:
            style: "elevated"
            on_release: app.root.ids.screen_manager_root.current = "todo"
            MDButtonText:
                text: "To-Do"

        MDButton:
            style: "elevated"
            on_release: app.root.ids.screen_manager_root.current = "flashCards"
            MDButtonText:
                text: "Flash Cards"

        MDButton:
            style: "elevated"
            on_release: app.root.ids.screen_manager_root.current = "timer"
            MDButtonText:
                text: "Timer"

        MDButton:
            style: "elevated"
            on_release: app.root.ids.screen_manager_root.current = "settings"
            MDButtonText:
                text: "Settings"

<ToDoScreen>:
    MDBoxLayout:
        orientation: 'vertical'
        spacing: dp(10)
        padding: dp(10), dp(10), dp(10), dp(70) #left, top, right, bottom            
        
        ScrollView:
            MDBoxLayout:
                id: todo_items_container
                orientation: "vertical"
                size_hint_y: None
                height: self.minimum_height
                padding: dp(10)
                spacing: dp(10)

        
        # Expandable input box
        MDBoxLayout:
            id: input_box
            orientation: 'vertical'
            size_hint_y: None
            height: dp(60)
            spacing: dp(5)
            padding: dp(5)
            

            # Additional fields (hidden initially, opacity=0)
            MDTextField: #This one temporarily holds the header text
                fill_color: 0, 0, 0, 0  # Required transparency fix for dev version
                id: task_header_input
                mode: "outlined"

                MDTextFieldHintText:
                    text: "Input Task Header"

            MDTextField: #This one temporarily holds the description text
                fill_color: 0, 0, 0, 0  # Required transparency fix for dev version
                id: task_description_input
                mode: "outlined"

                MDTextFieldHintText:
                    text: "Input Task Description"

            MDTextField: #This one temporarily holds the due date
                fill_color: 0, 0, 0, 0  # Required transparency fix for dev version
                id: task_date_input
                mode: "outlined"

                MDTextFieldHintText:
                    text: "Input Task Due Date (DD/MM/YYYY)"
            

            # Initial single-line input (at bottom, always visible initially)
            MDButton:
                id: new_task_input
                style: "elevated"
                #fill_color: 0, 0, 0, 0  # Required transparency fix for dev version
                size_hint_y: None
                height: dp(40)
                on_release: root.expand_input()

                MDButtonText:
                    text: "Add a new task..."
        
        # Controls "Add Task" button
        MDButton:
            style: "elevated"
            size_hint_y: None
            height: dp(40)
            on_release: root.addTask()
            MDButtonText:
                text: "Add Task"
                #on_press: todolist.addTask()
       
<FlashCardsScreen>:
    name: "flashCards"

    MDBoxLayout:
        orientation: "vertical"

        # --- Top-left add button locked to upper-right corner ---
        AnchorLayout:
            anchor_x: "right"
            anchor_y: "top"
            size_hint_y: None
            height: dp(64)
            padding: dp(8)

            MDButton:
                size_hint: None, None
                size: dp(130), dp(40)
                on_release: root.open_add_dialog()
                MDButtonText:
                    text: "+ Add Card"

        # small padding so the top of the flashcard sits just beneath the button
        Widget:
            size_hint_y: None
            height: dp(8)

        # --- Main area: arrows + card ---
        BoxLayout:
            size_hint_y: 1

            # Left column: left arrow, anchored to right
            AnchorLayout:
                anchor_x: "right"
                anchor_y: "center"
                size_hint_x: None
                width: "24dp"

                MDIconButton:
                    icon: "chevron-left"
                    size_hint: None, None
                    user_font_size: "48dp"
                    size: "24dp", "24dp"
                    on_release: root.prev_card()

            # Center column: anchored card + index (index locked directly underneath)
            AnchorLayout:
                anchor_x: "center"
                anchor_y: "center"

                MDBoxLayout:
                    orientation: "vertical"
                    size_hint: None, None
                    # width: follow available center column but max to a percent of window
                    width: min(self.parent.width * 0.95, root.width * 0.85)
                    # height: don't exceed 80% of the screen; otherwise be card + index height
                    height: min(root.height * 0.8, (self.width / 1.6667) + dp(32))

                    MDCard:
                        id: flashcard
                        elevation: 1
                        radius: 5
                        padding: "12dp"
                        ripple_behavior: True
                        on_release: root.flip_card()

                        # Keep 5:3 aspect ratio but never exceed available wrapper space
                        size_hint: None, None
                        width: self.parent.width
                        height: min(self.width / 1.6667, self.parent.height - index_label.height)

                        MDLabel:
                            id: flashcard_text
                            text: root.current_text
                            halign: "center"
                            valign: "center"
                            theme_text_color: "Primary"
                            text_size: self.width * 0.9, None

                    MDLabel:
                        id: index_label
                        text: f"{root.current_index + 1}/{len(root.cards)}" if root.cards else ""
                        halign: "center"
                        theme_text_color: "Secondary"
                        size_hint_y: None
                        height: dp(32)

            # Right column: right arrow, anchored to left
            AnchorLayout:
                anchor_x: "left"
                anchor_y: "center"
                size_hint_x: None
                width: "24dp"

                MDIconButton:
                    icon: "chevron-right"
                    size_hint: None, None
                    user_font_size: "36dp"
                    size: "24dp", "24dp"
                    on_release: root.next_card()

        # Bottom spacer
        Widget:
            size_hint_y: 0.05

<TimerScreen@MDScreen>:
    MDBoxLayout:
        orientation: 'vertical'
        spacing: dp(10)
        padding: dp(10), dp(10), dp(10), dp(70)

        # Timer display
        MDLabel: 
            id: timer_display
            text: root.timer_text
            halign: "center"

        MDLabel:
            id: status_label
            text: "Press Start to begin."
            halign: "center"

        MDBoxLayout:
            id: buttons
            orientation: "horizontal"
            spacing: dp(20)
            size_hint_y: None
            size_hint_x: None
            width: self.minimum_width
            height: dp(50)
            halign: "center"
            pos_hint: {"center_x": 0.5}

            # Start button
            MDButton: 
                style: "elevated"
                on_release: root.start_pomodoro()
                MDButtonText:
                    text: "Start"

            # Stop button
            MDButton: 
                style: "elevated"
                on_release: root.stop_pomodoro()
                MDButtonText:
                    text: "Stop"

            # Reset button
            MDButton: 
                style: "elevated"
                on_release: root.reset_pomodoro()
                MDButtonText:
                    text: "Reset"

        # Inputs
        MDBoxLayout: 
            id: timer_input
            orientation: 'horizontal'
            size_hint_y: None
            height: dp(60)
            spacing: dp(5)
            padding: dp(5)  
        
            MDTextField:
                id: work_minutes_input
                fill_color: 0, 0, 0, 1
                mode: "filled"
                text: "25"
                on_text: root.validate_int(self, 1, 60)

                MDTextFieldHintText:
                    text: "Work Minutes"

            MDTextField:
                id: short_break_minutes_input
                fill_color: 0, 0, 0, 1
                mode: "filled"
                text: "5"
                on_text: root.validate_int(self, 1, 30)

                MDTextFieldHintText:
                    text: "Short Break Minutes"

            MDTextField:
                id: long_break_minutes_input
                fill_color: 0, 0, 0, 1
                mode: "filled"
                text: "15"
                on_text: root.validate_int(self, 1, 60)

                MDTextFieldHintText:
                    text: "Long Break Minutes"

            MDTextField:    
                id: sessions_input
                fill_color: 0, 0, 0, 1
                mode: "filled"
                text: "4"
                on_text: root.validate_int(self, 1, 24)

                MDTextFieldHintText:
                    text: "Amount of Sessions"
        
                
<SettingsScreen@MDScreen>:
    AnchorLayout:
        anchor_x: "center"
        anchor_y: "center"

        MDButton:
            style: "elevated"
            size_hint: (None, None)
            width: dp(200)
            height: dp(50)
            on_release: root.toggle_dark_mode()

            MDButtonText:
                text: "Dark Mode"